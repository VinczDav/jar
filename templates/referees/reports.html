{% extends 'base.html' %}

{% block title %}Jelentések{% endblock %}
{% block page_title %}Ellenőri jelentések{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Elkészített jelentések</h3>
        <div style="display: flex; gap: 0.5rem;">
            <a href="{% url 'referees:create_report' %}" class="btn btn-primary">
                <span class="material-icons">add</span>
                Új jelentés
            </a>
        </div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Dátum</th>
                    <th>Mérkőzés</th>
                    <th>Játékvezetők</th>
                    <th>Státusz</th>
                    <th>Műveletek</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td data-label="Dátum">
                        <div>
                            <strong>{{ report.match.date|date:"Y.m.d" }}</strong>
                            {% if report.match.time %}
                            <span style="font-size: 0.8rem; color: var(--text-secondary); margin-left: 0.5rem;">{{ report.match.time|time:"H:i" }}</span>
                            {% endif %}
                        </div>
                    </td>
                    <td data-label="Mérkőzés">
                        <div>
                            <div>{{ report.match.home_team.name|default:"TBD" }} - {{ report.match.away_team.name|default:"TBD" }}</div>
                            {% if report.match.phase %}
                            <span class="badge" style="background-color: {{ report.match.phase.competition.color }}; color: white; font-size: 0.7rem;">
                                {{ report.match.phase.competition.short_name }}
                            </span>
                            {% endif %}
                        </div>
                    </td>
                    <td data-label="Játékvezetők">
                        <div>
                            {% for eval in report.evaluations.all %}
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span>{{ eval.referee.get_full_name }}</span>
                                <span style="color: #ffc107; font-size: 0.85rem;">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= eval.overall_rating %}★{% else %}☆{% endif %}
                                    {% endfor %}
                                </span>
                            </div>
                            {% empty %}
                            <span style="color: var(--text-secondary);">-</span>
                            {% endfor %}
                        </div>
                    </td>
                    <td data-label="Státusz">
                        {% if report.status == 'submitted' %}
                        <span class="badge" style="background: #22c55e; color: white;">Beküldve</span>
                        {% else %}
                        <span class="badge" style="background: #f59e0b; color: white;">Piszkozat</span>
                        {% endif %}
                    </td>
                    <td data-label="Műveletek">
                        <a href="{% url 'referees:view_report' report.id %}" class="btn btn-secondary btn-sm">
                            <span class="material-icons">visibility</span>
                            Megtekintés
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <span class="material-icons" style="font-size: 3rem; opacity: 0.5;">assignment</span>
                        <p>Nincs elkészített jelentés</p>
                        <a href="{% url 'referees:create_report' %}" class="btn btn-primary" style="margin-top: 1rem;">
                            <span class="material-icons">add</span>
                            Új jelentés készítése
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.badge {
    padding: 0.125rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
}
.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .card-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    .card-header .btn {
        width: 100%;
        justify-content: center;
    }

    /* Mobile card layout for table */
    .table-wrapper {
        overflow-x: visible;
    }
    .table-wrapper table {
        display: block;
    }
    .table-wrapper table thead {
        display: none;
    }
    .table-wrapper table tbody {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .table-wrapper table tr {
        display: flex;
        flex-direction: column;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1rem;
        gap: 0.5rem;
    }
    .table-wrapper table tr:hover {
        background: var(--card-bg);
    }
    .table-wrapper table td {
        padding: 0;
        border: none;
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
    }
    .table-wrapper table td::before {
        content: attr(data-label);
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
        min-width: 90px;
        flex-shrink: 0;
    }
    .table-wrapper table td:last-child {
        margin-top: 0.5rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-color);
        justify-content: flex-end;
    }
    .table-wrapper table td:last-child::before {
        display: none;
    }
    .table-wrapper table td:last-child .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% endblock %}
