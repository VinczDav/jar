{% extends "emails/base_email.html" %}
{% load tz %}

{% block title %}Mérkőzés lemondva - JAR{% endblock %}

{% block header_title %}Mérkőzés lemondva{% endblock %}

{% block content %}
<p style="font-size: 16px; color: #1e293b;">Tisztelt Adminisztrátor!</p>

<p><strong>{{ declining_user.get_full_name }}</strong> lemondta az alábbi mérkőzést:</p>

<table class="data-table">
    <tr>
        <th>Mérkőzés időpontja</th>
        <td>{{ match.date|date:"Y.m.d" }} ({{ match.date|date:"l" }}) {{ match.time|time:"H:i" }}</td>
    </tr>
    {% if match.venue %}
    <tr>
        <th>Helyszín</th>
        <td>{% if match.venue.google_maps_url %}<a href="{{ match.venue.google_maps_url }}" target="_blank" style="color: #2563eb; text-decoration: underline;">{{ match.venue.name }}</a>{% else %}{{ match.venue.name }}{% endif %}{% if match.venue.city %}, {{ match.venue.city }}{% endif %}</td>
    </tr>
    {% endif %}
    {% if match.phase and match.phase.competition %}
    <tr>
        <th>Bajnokság</th>
        <td>{{ match.phase.competition.name }}</td>
    </tr>
    {% endif %}
    {% if not match.is_tournament %}
    <tr>
        <th>Hazai csapat</th>
        <td>{{ match.home_team|default:"TBD" }}</td>
    </tr>
    <tr>
        <th>Vendég csapat</th>
        <td>{{ match.away_team|default:"TBD" }}</td>
    </tr>
    {% endif %}

    <!-- Közreműködők -->
    {% if all_assignments %}
    <tr class="section-divider">
        <th colspan="2" style="background: #1a365d; color: white; text-align: center; font-size: 13px; padding: 8px;">Közreműködők</th>
    </tr>
    {% for assign in all_assignments %}
    <tr{% if assign.user and assign.user.id == declining_user.id %} class="highlight"{% endif %}>
        <th>{{ assign.get_role_display }}</th>
        <td>
            {% if assign.user and assign.user.id == declining_user.id %}
                <span style="color: #dc2626; font-weight: 600;">Hiányzik!</span>
            {% elif assign.user %}
                {{ assign.user.get_full_name }}
            {% elif assign.placeholder_type == 'hianyzik' %}
                <span style="color: #dc2626; font-weight: 600;">Hiányzik</span>
            {% elif assign.placeholder_type == 'szukseges' %}
                <span style="color: #d97706; font-weight: 600;">Szükséges</span>
            {% elif assign.placeholder_type == 'nincs' %}
                <span style="color: #1e293b;">Nincs</span>
            {% else %}
                -
            {% endif %}
        </td>
    </tr>
    {% endfor %}
    {% endif %}
</table>

{% if assignment.decline_reason %}
<p style="margin-top: 16px;"><strong>Lemondás indoka:</strong> {{ assignment.decline_reason }}</p>
{% endif %}
{% endblock %}
